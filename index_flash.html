<!DOCTYPE html>
<html lang="vi">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Demo Flash Loan Attack (SC07)</title>
    <style>
        body { font-family: 'Segoe UI', sans-serif; max-width: 800px; margin: 20px auto; background-color: #f8f9fa; padding: 20px; }
        .card { background: white; padding: 25px; border-radius: 12px; box-shadow: 0 4px 15px rgba(0,0,0,0.05); margin-bottom: 20px; }
        h1 { color: #2c3e50; text-align: center; }
        h2 { color: #34495e; border-bottom: 2px solid #eee; padding-bottom: 10px; font-size: 1.2rem; }
        
        input { width: 100%; padding: 12px; margin: 8px 0; border: 1px solid #dee2e6; border-radius: 6px; box-sizing: border-box; font-family: monospace; }
        
        button { background: #3498db; color: white; border: none; padding: 12px 20px; border-radius: 6px; cursor: pointer; font-weight: 600; width: 100%; margin-top: 10px; transition: 0.2s; }
        button:hover { background: #2980b9; }
        
        button.danger { background: #e74c3c; font-size: 1.1rem; }
        button.danger:hover { background: #c0392b; }
        
        .status { margin-top: 15px; padding: 15px; background: #e8f4f8; border-radius: 6px; color: #2980b9; font-weight: 500; text-align: center; }
        
        .balance-row { display: flex; justify-content: space-between; margin: 12px 0; padding-bottom: 8px; border-bottom: 1px dashed #eee; }
        .amount { font-weight: bold; color: #27ae60; font-family: monospace; font-size: 1.1rem; }
    </style>
</head>
<body>
    <h1>‚ö° Demo T·∫•n c√¥ng Flash Loan (SC07)</h1>

    <!-- 1. K·∫øt n·ªëi -->
    <div class="card">
        <button id="connectBtn">üîå 1. K·∫øt n·ªëi MetaMask (M·∫°ng Localhost)</button>
        <div id="walletStatus" class="status">Ch∆∞a k·∫øt n·ªëi</div>
    </div>

    <!-- 2. C·∫•u h√¨nh -->
    <div class="card">
        <h2>üìù 2. C·∫•u h√¨nh (Copy t·ª´ Terminal)</h2>
        <input type="text" id="poolAddr" placeholder="D√°n ƒë·ªãa ch·ªâ FlashLoanPool (Ng√¢n h√†ng)">
        <input type="text" id="govAddr" placeholder="D√°n ƒë·ªãa ch·ªâ VulnerableGovernance (N·∫°n nh√¢n)">
        <input type="text" id="attackAddr" placeholder="D√°n ƒë·ªãa ch·ªâ FlashLoanAttack (Hacker)">
    </div>

    <!-- 3. Theo d√µi ti·ªÅn -->
    <div class="card">
        <h2>üí∞ 3. Tr·∫°ng th√°i T√†i s·∫£n</h2>
        <div class="balance-row">
            <span>üè¶ Ng√¢n h√†ng (Pool):</span>
            <span id="poolBal" class="amount">... ETH</span>
        </div>
        <div class="balance-row">
            <span>üèõÔ∏è Qu·ªπ th∆∞·ªüng (Governance):</span>
            <span id="govBal" class="amount">... ETH</span>
        </div>
        <div class="balance-row">
            <span>üòà Contract Hacker:</span>
            <span id="attackBal" class="amount">0.0 ETH</span>
        </div>
        <button onclick="updateBalances()">üîÑ C·∫≠p nh·∫≠t s·ªë d∆∞</button>
    </div>

    <!-- 4. T·∫•n c√¥ng -->
    <div class="card">
        <h2>‚ò†Ô∏è 4. K·ªãch b·∫£n T·∫•n c√¥ng</h2>
        <p>üîí <b>ƒêi·ªÅu ki·ªán r√∫t qu·ªπ:</b> Ph·∫£i c√≥ s·ªë d∆∞ v√≠ > 900 ETH.</p>
        <p>üí° <b>Chi·∫øn thu·∫≠t:</b> Hacker vay n√≥ng 1000 ETH -> R√∫t qu·ªπ -> Tr·∫£ n·ª£.</p>
        <button id="attackBtn" class="danger">üöÄ TH·ª∞C HI·ªÜN FLASH LOAN ATTACK</button>
    </div>

    <!-- Ethers.js -->
    <script src="https://cdnjs.cloudflare.com/ajax/libs/ethers/5.7.2/ethers.umd.min.js"></script>
    <script>
        let provider, signer;

        // ABI ch·ªâ c·∫ßn khai b√°o h√†m ch√∫ng ta g·ªçi
        const attackABI = ["function attack() external"];

        function log(msg) {
            document.getElementById("walletStatus").innerText = msg;
        }

        async function connect() {
            if (!window.ethereum) return alert("C√†i MetaMask ƒëi b·∫°n!");
            provider = new ethers.providers.Web3Provider(window.ethereum);
            await provider.send("eth_requestAccounts", []);
            signer = provider.getSigner();
            const addr = await signer.getAddress();
            log("‚úÖ ƒê√£ k·∫øt n·ªëi: " + addr.substring(0,6) + "..." + addr.substring(38));
        }

        async function updateBalances() {
            const pAddr = document.getElementById("poolAddr").value.trim();
            const gAddr = document.getElementById("govAddr").value.trim();
            const aAddr = document.getElementById("attackAddr").value.trim();

            if(!pAddr || !gAddr) return log("‚ö†Ô∏è Vui l√≤ng nh·∫≠p ƒë·ªãa ch·ªâ contract tr∆∞·ªõc!");

            try {
                const pBal = await provider.getBalance(pAddr);
                const gBal = await provider.getBalance(gAddr);
                const aBal = await provider.getBalance(aAddr);

                document.getElementById("poolBal").innerText = ethers.utils.formatEther(pBal) + " ETH";
                document.getElementById("govBal").innerText = ethers.utils.formatEther(gBal) + " ETH";
                document.getElementById("attackBal").innerText = ethers.utils.formatEther(aBal) + " ETH";
            } catch (e) {
                log("L·ªói l·∫•y s·ªë d∆∞ (ki·ªÉm tra l·∫°i ƒë·ªãa ch·ªâ)");
            }
        }

        async function attack() {
            const attackAddr = document.getElementById("attackAddr").value.trim();
            if (!attackAddr) return alert("Nh·∫≠p ƒë·ªãa ch·ªâ contract hacker!");
            if (!signer) return alert("Ch∆∞a k·∫øt n·ªëi v√≠!");

            const attackContract = new ethers.Contract(attackAddr, attackABI, signer);
            
            log("‚è≥ ƒêang th·ª±c hi·ªán Flash Loan...");
            
            try {
                // G·ªçi h√†m attack()
                const tx = await attackContract.attack();
                await tx.wait();
                log("‚úÖ T·∫§N C√îNG TH√ÄNH C√îNG! ƒê√£ r√∫t c·∫°n qu·ªπ.");
                updateBalances();
            } catch (err) {
                console.error(err);
                log("‚ùå Th·∫•t b·∫°i: " + (err.reason || err.message));
            }
        }

        document.getElementById("connectBtn").onclick = connect;
        document.getElementById("attackBtn").onclick = attack;
    </script>
</body>
</html>